var Exam;Exam=function(){function t(t){if(this._translator=new Translator,this._parser=new Parser(new Lexer),this._objects=[],this._separateChecking=!0,this._lang=markdown.toHTML,t){if(null!=t.separateChecking){if("boolean"!=typeof t.separateChecking)throw new Error('parameter "separateChecking" must be a type of boolean');this._separateChecking=t.separateChecking}if(null!=t.finishBtnID){if("string"!=typeof t.finishBtnID)throw new Error('parameter "finishBtnID" must be a type of string');this._finishBtnID=t.finishBtnID}if(null!=t.lang){if("function"!=typeof t.lang)throw new Error('parameter "lang" must be a type of function');this._lang=t.lang}this._setCallbacks(t)}}return t.prototype._setCallbacks=function(t){if(t.separateCheckingHandler){if("function"!=typeof t.separateCheckingHandler)throw new Error('parameter "separateCheckingHandler" must be a type of function');this._separateCheckingHandler=t.separateCheckingHandler}if(t.finishBtnHandler){if("function"!=typeof t.finishBtnHandler)throw new Error('parameter "finishBtnHandler" must be a type of function');return this._finishBtnHandler=t.finishBtnHandler}},t.prototype.parse=function(t){var e,n,r,s,o;for(r=this._lang(t),this._objects=this._parser.parse(r),e=this._translator.convertAllObjects(this._objects),s=0,o=e.length;o>s;s++)n=e[s],r=r.replace(n.source,n.result);return r},t.prototype._getRightAnswer=function(t){var e;return e=t instanceof List?t.items[t.rightAnswerIndex]:t instanceof TextInput?t.rightAnswer:t.rightAnswers},t.prototype._validateCheckBox=function(t){var e,n,r,s,o,i,a,c,p,u;for(s=!0,r=document.querySelectorAll("#"+t.id+" .examjs-checkbox"),i=[],a=0,p=r.length;p>a;a++)n=r[a],n.checked&&i.push(n.nextSibling.data);if(o=this._getRightAnswer(t),o.length===i.length)for(c=0,u=o.length;u>c;c++)e=o[c],s=s&&-1!==i.indexOf(e);else s=!1;return s},t.prototype._separateCheckingHandler=function(t){var e,n,r;return e=document.getElementById(t.id),r=e.value,n=this._getRightAnswer(t),t instanceof CheckBox?void(e.style.color=this._validateCheckBox(t)?"#7fe817":"#e42217"):null!=r||null!=n?e.style.color=n.toLowerCase()===r.toLowerCase()?"#7fe817":"#e42217":void 0},t.prototype.getAnswersInformation=function(){var t,e,n,r,s,o,i,a,c;for(t=0,n={idOfRightAnswers:[]},c=this._objects,i=0,a=c.length;a>i;i++)e=c[i],o=document.getElementById(e.id),o&&(e instanceof CheckBox?this._validateCheckBox(e)&&(t++,n.idOfRightAnswers.push(e.id)):(r=this._getRightAnswer(e),s=o.value,(null!=s?s.toLowerCase():void 0)===(null!=r?r.toLowerCase():void 0)&&(t++,n.idOfRightAnswers.push(e.id))));return n.tests=this._objects.length,n.rightAnswers=t,n},t.prototype.onAnswer=function(t,e){var n,r,s,o,i,a,c,p;if(s=[],t instanceof Array)for(o=0,a=t.length;a>o;o++)n=t[o],s.push(document.getElementById(n));else s.push(document.getElementById(t));for(p=[],i=0,c=s.length;c>i;i++)r=s[i],r.oninput=function(t){return function(){var n;return n=t.getAnswersInformation(),e(n.tests,n.rightAnswers)}}(this),p.push(r.onchange=function(t){return function(){var n;return n=t.getAnswersInformation(),e(n.tests,n.rightAnswers)}}(this));return p},t.prototype._finishBtnHandler=function(){var t;return t=this.getAnswersInformation(),window.alert("Count of a right answers: "+t.rightAnswers+"/"+asnwersInformation.tests)},t.prototype.startExam=function(){var t,e;return e=this,e._objects.forEach(function(t){var n;return n=document.getElementById(t.id),(t instanceof List||t instanceof TextInput)&&e._separateChecking?n.oninput=function(){return e._separateCheckingHandler(t)}:t instanceof CheckBox&&e._separateChecking?n.onchange=function(){return e._separateCheckingHandler(t)}:void 0}),null!=e._finishBtnID?(t=document.getElementById(e._finishBtnID),t.onclick=function(){return e._finishBtnHandler()}):void 0},t}(),this.Exam=Exam;var AnswerSeparator,HelpSeparator,InputToken,Item,ItemsSeparator,LEXER_HELPER,Lexer,__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};LEXER_HELPER={trim:function(t){return t?t.replace(/^\s+/,"").replace(/\s+$/,""):void 0}},Item=function(){function t(t){this.value=t,this.value=LEXER_HELPER.trim(this.value)}return t}(),InputToken=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(Item),AnswerSeparator=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(Item),ItemsSeparator=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(Item),HelpSeparator=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(Item),Lexer=function(){function t(){this.tokens={ANSWER_SPTR:"::",HELP_SPTR:":?",ITEMS_SPTR:",",INPUT_TOKEN:"...",START_BLOCK_TOKEN:"{{",END_BLOCK_TOKEN:"}}"}}return t.prototype._clearSyntaxBlock=function(t){return t.substring(0,2)===this.tokens.START_BLOCK_TOKEN&&(t=t.substring(2)),t.substring(t.length-2)===this.tokens.END_BLOCK_TOKEN&&(t=t.substring(0,t.length-2)),t},t.prototype._isEmpty=function(t){return""===LEXER_HELPER.trim(t)},t.prototype._isPartOfToken=function(t){return-1!==this.tokens.ITEMS_SPTR.indexOf(t)||-1!==this.tokens.ANSWER_SPTR.indexOf(t)||-1!==this.tokens.HELP_SPTR.indexOf(t)||-1!==this.tokens.INPUT_TOKEN.indexOf(t)},t.prototype._isToken=function(t){return t===this.tokens.ITEMS_SPTR||t===this.tokens.ANSWER_SPTR||t===this.tokens.HELP_SPTR||t===this.tokens.INPUT_TOKEN},t.prototype.parse=function(t){var e,n,r,s,o,i,a,c,p;for(e=[],r="",i="",s=t,t=this._clearSyntaxBlock(t),a=function(t){return function(e,n){t._isEmpty(n)||(n===t.tokens.ITEMS_SPTR&&e.push(new ItemsSeparator(n)),n===t.tokens.ANSWER_SPTR&&e.push(new AnswerSeparator(n)),n===t.tokens.HELP_SPTR&&e.push(new HelpSeparator(n)),n===t.tokens.INPUT_TOKEN&&e.push(new InputToken(n)))}}(this),c=0,p=t.length;p>c;c++)o=t[c],n=o,this._isPartOfToken(i+n)?i+=n:this._isPartOfToken(n)?(r+=i,i=n):(r+=i+n,i=""),this._isToken(i)&&(this._isEmpty(r)||e.push(new Item(r)),a(e,i),r="",i="");return e.push(new Item(r)),e=e.filter(function(){return function(t){return null!=t.value}}(this)),{expression:e,syntaxBlock:s}},t}(),this.Item=Item,this.InputToken=InputToken,this.AnswerSeparator=AnswerSeparator,this.ItemsSeparator=ItemsSeparator,this.HelpSeparator=HelpSeparator,this.Lexer=Lexer;var CheckBox,ExamObject,ImageCheckBox,List,Parser,TextInput,__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};ExamObject=function(){function t(t,e,n){this.syntaxBlock=t,this.helpText=e,this.id=n,e&&(this._helpTagId="help_"+this.id)}return t}(),List=function(t){function e(t,n,r,s,o){e.__super__.constructor.call(this,t,n,r),this.items=s,this.rightAnswerIndex=o}return __extends(e,t),e}(ExamObject),TextInput=function(t){function e(t,n,r,s){e.__super__.constructor.call(this,t,n,r),this.rightAnswer=s}return __extends(e,t),e}(ExamObject),CheckBox=function(t){function e(t,n,r,s,o){e.__super__.constructor.call(this,t,n,r),this.items=s,this.rightAnswers=o}return __extends(e,t),e}(ExamObject),ImageCheckBox=function(t){function e(t,n,r,s,o){e.__super__.constructor.call(this,t,n,r),this.items=s,this.rightAnswers=o}return __extends(e,t),e}(ExamObject),Parser=function(){function t(t){this._patterns={blockPattern:/\{\{(.|\n)*?\}\}/g,emptyBlock:"{{}}"},this._currentID=0,this.lexer=t}return t.prototype._trim=function(t){var e;return e=/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,t.replace(e,"").replace(/\s+/g," ")},t.prototype._getNextID=function(){return"examjsid_"+ ++this._currentID},t.prototype._indexOfRightAnswer=function(t,e){var n,r,s,o;if(r=-1,e)for(s=0,o=t.length;o>s;s++)n=t[s],this._trim(n.toLowerCase())===this._trim(e.toLowerCase())&&(r=t.indexOf(n));return r},t.prototype._createList=function(t,e){var n,r;return r=this._indexOfRightAnswer(t.items,t.answers[0]),n=this._getNextID(),new List(e,t.helpText,n,t.items,r)},t.prototype._createTextInput=function(t,e){var n;return n=this._getNextID(),new TextInput(e,t.helpText,n,t.answers[0])},t.prototype._createCheckBox=function(t,e){var n;return n=this._getNextID(),new CheckBox(e,t.helpText,n,t.items,t.answers)},t.prototype._parseSyntaxBlocks=function(t){var e;return e=new RegExp(this._patterns.blockPattern),t.match(e)},t.prototype._extractObjects=function(t){var e,n,r,s,o;if(n=[],null!==t)for(s=0,o=t.length;o>s;s++)e=t[s],r=this._parseExpression(e.expression),n.push(r.hasInputToken?this._createTextInput(r,e.syntaxBlock):r.answers.length>1?this._createCheckBox(r,e.syntaxBlock):this._createList(r,e.syntaxBlock));return n},t.prototype._parseExpression=function(t){var e,n,r,s,o;for(n={items:[],answers:[],hasInputToken:!1},e=null,s=0,o=t.length;o>s;s++)if(r=t[s],!(r instanceof ItemsSeparator))switch(!1){case!(r instanceof InputToken):n.hasInputToken=!0;break;case!(r instanceof AnswerSeparator):e=r;break;case!(r instanceof HelpSeparator):e=r;break;case!(r instanceof Item&&null===e):n.items.push(r.value);break;case!(r instanceof Item&&e instanceof AnswerSeparator):n.answers.push(r.value);break;case!(r instanceof Item&&e instanceof HelpSeparator):n.helpText=r.value}return n},t.prototype.parse=function(t){var e,n,r,s,o;if("string"!=typeof t)throw new Error("Parser Error: into the parse() method was passed not a string parameter");if(r=this._parseSyntaxBlocks(t),n=[],r)for(s=0,o=r.length;o>s;s++)e=r[s],n.push(this.lexer.parse(e));return this._extractObjects(n)},t}(),this.Parser=Parser,this.List=List,this.TextInput=TextInput,this.CheckBox=CheckBox;var Translator;Translator=function(){function t(){}return t.prototype._createTextInput=function(t){var e;return e="<input type='text' id='"+t.id+"' class='examjs-input'></input>",t.helpText&&(e+="<div id='"+t._helpTagId+"' class='examjs-help-popup' data-help='"+t.helpText+"'>?</div>"),"<div class='examjs-block'>"+e+"</div>"},t.prototype._createListBox=function(t){var e,n,r,s,o;for(n="<select id='"+t.id+"' class='examjs-input'>",n+="<option></option>",o=t.items,r=0,s=o.length;s>r;r++)e=o[r],n+="<option>"+e+"</option>";return n+="</select>",t.helpText&&(n+="<div id='"+t._helpTagId+"' class='examjs-help-popup' data-help='"+t.helpText+"'>?</div>"),"<div class='examjs-block'>"+n+"</div>"},t.prototype._createCheckBox=function(t){var e,n,r,s,o;for(n="<div id='"+t.id+"' class='examjs-block'>",o=t.items,r=0,s=o.length;s>r;r++)e=o[r],n+="<div><input type='checkbox' class='examjs-checkbox'>"+e+"</input></div>";return n+="</div>",t.helpText&&(n+="<div id='"+t._helpTagId+"' class='examjs-help-popup examjs-checkbox-popup' data-help='"+t.helpText+"'>?</div>"),"<div class='examjs-checkbox-block'>"+n+"</div>"},t.prototype.convertAllObjects=function(t){var e,n,r,s;for(n=[],r=0,s=t.length;s>r;r++)if(e=t[r],e instanceof List)n.push({source:e.syntaxBlock,result:this._createListBox(e),block:"list"});else if(e instanceof TextInput)n.push({source:e.syntaxBlock,result:this._createTextInput(e),block:"textInput"});else{if(!(e instanceof CheckBox))throw new Error("Converting error. Translator cannot convert object that was passed into it");n.push({source:e.syntaxBlock,result:this._createCheckBox(e),block:"checkBox"})}return n},t}(),this.Translator=Translator;